---
layout: post
title: 'springboot Flyway 간단사용법 '
date: '2020-06-04T07:41:00.005-07:00'
author: schoolhompy
tags:
- flyway
modified_time: '2020-07-28T19:19:36.603-07:00'
blogger_id: tag:blogger.com,1999:blog-4954243635432022205.post-4404020840026747997
blogger_orig_url: https://yunhos.blogspot.com/2020/06/springboot-flyway.html
---

그레이들의 특정 태스크에 추가해서 디비정합성이 맞는지도 체크하고,<br /><div>누군가가 새로운 sql 을 넣은게 있다면 자동으로 갱신도하고. 좋다.</div><div><br /></div><div>일단 sql 은 resources/db/migration/V6__Create_smple_table.sql( V아무거나__아무설명.sql) 로 저장하면됨.</div><div>자동으로 디비에&nbsp;flyway_schema_history 이런테이블에 들어가는데 형상관리(정합성)해주는거임</div><div><br /></div><div>사용은 이렇게 ...<br /><div><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;">plugins <span style="font-weight: bold;">{</span><span style="font-weight: bold;">    </span>id <span style="color: #067d17;">"org.flywaydb.flyway" </span>version <span style="color: #067d17;">"6.4.3"</span><span style="font-weight: bold;">}</span></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="font-weight: bold;"><br /></span></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="font-weight: bold;"><br /></span></pre></div><div><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;">bootRunMe <span style="font-weight: bold;">{</span><span style="font-weight: bold;">    </span>systemProperty <span style="color: #067d17;">'spring.profiles.active'</span>, <span style="color: black;">System</span>.<span style="font-style: italic;">properties</span>[<span style="color: #067d17;">'spring.profiles.active'</span>]<br /><br />    doFirst <span style="font-weight: bold;">{</span><span style="font-weight: bold;">        </span></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;">      task migrateDatabase1(<span style="color: #067d17;">type</span>: org.flywaydb.gradle.task.<span style="color: black;">FlywayMigrateTask</span>) <span style="font-weight: bold;">{</span><span style="font-weight: bold;">            </span></pre><pre style="background-color: white; font-size: 9.8pt;"><span style="color: #871094; font-family: &quot;jetbrains mono&quot;;">             url </span><font color="#080808" face="jetbrains mono">= </font><span style="color: #067d17; font-family: &quot;jetbrains mono&quot;;">'jdbc:mysql://localhost:3306/</span><font color="#080808" face="jetbrains mono">mymydb'<br /></font><span style="color: #067d17; font-family: &quot;jetbrains mono&quot;;">            </span><span style="color: #871094; font-family: &quot;jetbrains mono&quot;;">user </span><font color="#080808" face="jetbrains mono">= </font><span style="color: #067d17; font-family: &quot;jetbrains mono&quot;;">'</span><font color="#080808" face="jetbrains mono">uuu'<br /></font><span style="color: #067d17; font-family: &quot;jetbrains mono&quot;;">            </span><span style="color: #871094; font-family: &quot;jetbrains mono&quot;;">password </span><font color="#080808" face="jetbrains mono">= </font><span style="color: #067d17; font-family: &quot;jetbrains mono&quot;;">'</span><font color="#080808" face="jetbrains mono">ppp'<br />            </font><span style="color: #871094; font-family: &quot;JetBrains Mono&quot;; font-size: 9.8pt;">baselineVersion </span><span style="color: #080808; font-family: &quot;JetBrains Mono&quot;; font-size: 9.8pt;">= </span><span style="font-size: 9.8pt;"><font color="#1750eb" face="JetBrains Mono">1.0<br /></font></span><font color="#080808" face="jetbrains mono">            </font><span style="color: #871094; font-family: &quot;JetBrains Mono&quot;; font-size: 9.8pt;">baselineOnMigrate </span><span style="color: #080808; font-family: &quot;JetBrains Mono&quot;; font-size: 9.8pt;">= </span><span style="font-size: 9.8pt;"><font color="#0033b3" face="JetBrains Mono">true<br /></font></span>            <span style="color: #871094; font-family: &quot;JetBrains Mono&quot;; font-size: 9.8pt;">baselineDescription </span><span style="color: #080808; font-family: &quot;JetBrains Mono&quot;; font-size: 9.8pt;">= </span><span style="color: #067d17; font-family: &quot;JetBrains Mono&quot;; font-size: 9.8pt;">"Base Migration"</span><span style="color: #0033b3; font-family: &quot;JetBrains Mono&quot;; font-size: 9.8pt;"><br /></span><font color="#080808" face="jetbrains mono"><br /></font><span style="color: #067d17; font-family: &quot;jetbrains mono&quot;;">        </span><span style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-weight: bold;">}</span><span style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-weight: bold;">        </span></pre><pre style="background-color: white; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #080808;">       tasks.</span><span style="color: #067d17;">migrateDatabase1</span><span style="color: #080808;">.execute()</span><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="font-weight: bold;"><br /></span><span style="font-weight: bold;">        </span>task migrateDatabase2(<span style="color: #067d17;">type</span>: org.flywaydb.gradle.task.<span style="color: black;">FlywayMigrateTask</span>) <span style="font-weight: bold;">{</span><span style="font-weight: bold;">  </span></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #871094;">            url </span>= <span style="color: #067d17;">'jdbc:mysql://localhost:3307/mymydb'</span><span style="color: #067d17;">      </span></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #067d17;">            </span><span style="color: #871094;">user </span>= <span style="color: #067d17;">'uuu'</span><span style="color: #067d17;">     </span></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #871094;">            password </span>= <span style="color: #067d17;">'ppp'</span><span style="color: #067d17;">   </span></pre><pre style="font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #067d17;">       </span><span style="color: #080808; font-weight: bold;">}</span><span style="color: #080808; font-weight: bold;">       </span></pre><span style="color: #080808;"></span><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><b>      </b>tasks.<span style="color: #067d17;">migrateDatabase2</span>.execute()</pre><span style="color: #080808;"></span><span style="color: #080808; font-weight: bold;">    } </span></pre><pre style="background-color: white; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #080808; font-weight: bold;">}</span></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="font-weight: bold;"><br /></span></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="font-weight: bold;">bootRunMe 태스크빌드를 실행하면 doFirst 가 달리면서 여러서버의 디비정보를 최신업데이트된걸로 해줌.</span></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="font-weight: bold;">별디비 다해줌. sqlite도 가능하므로 안드로이드에서도 가능</span></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="font-weight: bold;"><br /></span></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><b>걍 gradle 의 task 중</b></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><b>...</b></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><b>myRunTask{</b></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><b>  doFirst {</b></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><b>     flywayMigrate.execute()</b></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><b>}</b></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><b>...</b></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><b>넣어줘</b></pre></div></div>