---
layout: post
title: Spring boot Eureka 해보자
date: '2020-06-27T09:27:00.002-07:00'
author: schoolhompy
tags:
- springboot
- eureka
- Springboot cloud config
modified_time: '2020-06-27T21:57:56.846-07:00'
blogger_id: tag:blogger.com,1999:blog-4954243635432022205.post-2636584003988599982
blogger_orig_url: https://yunhos.blogspot.com/2020/06/spring-boot-eureka.html
---

Spring boot Cloud Eureka&nbsp;<div><br /></div><div>마이크로서비스에서 다수의 서버들에 대한 정보를 관리하는게 필요하다. 유레카가 그거다. 유레카서버를 두고 각 클라이언트들이 유레카서버에 등록하면 된다.</div><div>스프링부트에서는 의존성추가해서 서버-클라이언트 지정하면 끝. 노드제이에스 같은경우 라이브러리로 가능.</div><div><br /></div><div>유레카 서버는 음..그냥 현재 클라우드에 구성된 하위 마이크로 서비스들에 대한 구성값을 저장할 뿐이다. 사용자의 요청에 따른 라우팅 , 또는 로드밸런싱을 위해서는 Zuul 서비스를 연동한다.</div><div><br /></div><div>유레카 서버는 30초마다 등록된 클라이언트에 핑을 보내서 이용가능한 서비스인지 확인하다. 로드밸런싱을 위해 리본(클라이언트 로드밸런서?) 를 사용한다.</div><div><br /></div><div>1. Spring boot Cloud Eureka Server</div><div>의존성과 포트 설정만 지정하면 일단 서버 기동은 끝. 스프링부트 정말 좋다.</div><div>- spring initializr 사이트에서 eureka 의존성 추가해서 프로젝트 생성, web도 추가.</div><div>다른언어로 개발됬거나 별도로 디스커버리서버(유레카 서버가 들고 있는정보) 가 필요할때는 제공되는 유레카 API를 이용한다.</div><div>( /eureka/apps, euraka/instance 등등..)</div><div><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><br />   implementation <span style="color: #067d17;">'org.springframework.cloud:spring-cloud-starter-netflix-eureka-server'</span></pre><pre style="background-color: white; color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><br class="Apple-interchange-newline" /><span style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;">- application.yml 에 서버 설정</span></pre><pre style="background-color: white;"><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #0033b3;">server</span>:<br />  <span style="color: #0033b3;">port</span>: 8761 &lt;-- 포트는 맘대로 보통 8761 인가보다<br /><br /><span style="color: #8c8c8c; font-style: italic;"># -- Eureka<br /></span><span style="color: #0033b3;">eureka</span>:<br />  <span style="color: #0033b3;">instance</span>:<br />    <span style="color: #0033b3;">hostname</span>: 127.0.0.1<br />  <span style="color: #0033b3;">client</span>:<br />    <span style="color: #0033b3;">serviceUrl</span>:<br />      <span style="color: #0033b3;">defaultZone</span>: http://${eureka.instance.hostname}:${server.port}/eureka/<br />    <span style="color: #0033b3;">register-with-eureka</span>: false &lt;-- 서버자신이 유레카에 등록할지를 결정, 지가 서버이면서 클라이언트도 가능<br />    <span style="color: #0033b3;">fetch-registry</span>: false &lt;-- 클라이언트들이 로컬에 서버로부터 받은 클라이언트리스트정보를 로컬에 캐싱할지 결정<br />  server<span style="font-size: 9.8pt;">:<br /></span>    <span style="color: #0033b3; font-size: 9.8pt;">enable-self-preservation</span><span style="font-size: 9.8pt;">: false &lt;-- true일때는 클라이언트가 죽어도 서버에서 죽지 않은걸로 인식, 보통 false 다</span></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><br class="Apple-interchange-newline" /><span style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;">- application에 유레카 서버라고 설정</span></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #9e880d;">@EnableEurekaServer<br /></span><span style="color: #9e880d;">@SpringBootApplication<br /></span><span style="color: #0033b3;">public class </span><span style="color: black;">DemoApplication </span>{<br /><br />   <span style="color: #0033b3;">public static void </span><span style="color: #00627a;">main</span>(<span style="color: black;">String</span>[] args) {<br />      <span style="color: black;">SpringApplication</span>.<span style="font-style: italic;">run</span>(<span style="color: black;">DemoApplication</span>.<span style="color: #0033b3;">class</span>, args);<br />   }<br /><br />}<br /></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;">이제 서버주소만 입력해도 정보가 출력된다. 유레카!</pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;">** resource 밑에 static, template가 있으면 화이트 지랄 화면이 보인다. 폴더 지우고 리빌드 하고 실행.</pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;">여러대의 서버에서 구성하고자 할떄는</pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><pre style="font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #0033b3;">spring</span>:<br />  <span style="color: #0033b3;">profiles</span>: default<br />  <span style="color: #0033b3;">application</span>:<br />    <span style="color: #0033b3;">name</span>: eureka-server-clustered<br /><span style="color: #0033b3;">server</span>:<br />  <span style="color: #0033b3;">port</span>: 8761<br /><span style="color: #0033b3;">eureka</span>:<br />  <span style="color: #0033b3;">instance</span>:<br />    <span style="color: #0033b3;">hostname</span>: 192.168.0.103<br />  <span style="color: #0033b3;">client</span>:<br />    <span style="color: #0033b3;">registerWithEureka</span>: true<br />    <span style="color: #0033b3;">fetchRegistry</span>: true<br />    <span style="color: #0033b3;">serviceUrl</span>:<br />      <span style="color: #0033b3;">defaultZone</span>: http://192.168.0.106:8761/eureka/,http://192.168.0.107:8761/eureka/</pre><pre style="font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;">식으로 디폴트존을 여러개(서로 얽히게끔) 둔다. 일단 peer-to-peer 라고 서버상태를 전부 복제하는 방식이다.</pre><pre style="font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><a href="https://projects.spring.io/spring-cloud/spring-cloud.html#_peer_awareness">https://projects.spring.io/spring-cloud/spring-cloud.html#_peer_awareness</a></pre><pre style="font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><br /></pre></pre><pre><div style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;"><br class="Apple-interchange-newline" /><br /></div><div style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;">2. Spring boot Cloud Eureka Client</div><div style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;">유레카 클라이언트 의존성을 추가하고 actuator 도 의존성 추가필요. 액튜에이터가 있어야 서버가 클라이언트의 상태를 파악하지.</div><div style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;">유레가 서버가 heartbeat 를 보내주는데, 클라이언트가 이를 못받으면 유레카서버는 클라이언트를 삭제한다.</div><div style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;">클라이언트는 서버로부터 레지스트리(클라이언트목록)을 캐싱하고 주기적으로 변경사항을 점검한다<br />- 일단 의존성 추가</div><div style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;"><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;">implementation <span style="color: #067d17;">'org.springframework.cloud:spring-cloud-starter-netflix-eureka-client'<br /></span>implementation <span style="color: #067d17;">'org.springframework.boot:spring-boot-starter-actuator'</span></pre><br />- application.yml 생성</div><div><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt; white-space: normal;"><span style="color: #0033b3;">server</span>:<br /><span style="color: #0033b3;">&nbsp; port</span>: ${PORT:8081}<br /><br /><span style="color: #0033b3;">spring</span>:<br />  <span style="color: #0033b3;">&nbsp; application</span>:<br />    <span style="color: #0033b3;">&nbsp; &nbsp; name</span>: ${NAME:customerservice} &lt;-- 같은 서비스를 여러개(여러서버)를 두고 서비스하고 싶을떄는 이름을 같게 하면<br />유레카에서 같은 이름끼리 묶어서 표시한다. 이를 zuul등에서 같은 service-id (serviceId<span style="font-family: &quot;JetBrains Mono&quot;; font-size: 9.8pt;">: customerservice) 로 지정하면 라운드로빈 방식으로 서버를 돌아가며 요청한다. 따라서 같은 이름의 서비스서버중 1번 서버에는 출력'가'로 되는데, 2번 서버에는 출력'나'로 되어있으면 가-&gt;나-&gt;가-&gt;나..순으로 데이터가 표시된다.</span><br /><br /><span style="color: #0033b3;">eureka</span>:<br />  <span style="color: #0033b3;">&nbsp; client</span>:<br />    <span style="color: #0033b3;">&nbsp; &nbsp; serviceUrl</span>:<br />      <span style="color: #0033b3;">&nbsp; &nbsp; defaultZone</span>: ${EUREKA_URL:http://127.0.0.1:8761/eureka/}<br />    <span style="color: #0033b3;">&nbsp; &nbsp; enabled</span>: true<br />  <span style="color: #0033b3;">&nbsp; instance</span>:<br />    <span style="color: #0033b3;">&nbsp; &nbsp; preferIpAddress</span>: true <br /></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt; white-space: normal;"><br style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;" /><span style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;">- 애플리케이션이 유레카 클라이언트라고 지정</span></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt; white-space: normal;"><pre style="font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><span style="color: #9e880d;">@EnableDiscoveryClient<br /></span><span style="color: #9e880d;">@SpringBootApplication<br /></span><span style="color: #0033b3;">public class </span><span style="color: black;">EurekaclientApplication </span>{<br /><br />   <span style="color: #0033b3;">public static void </span><span style="color: #00627a;">main</span>(<span style="color: black;">String</span>[] args) {<br />      <span style="color: black;">SpringApplication</span>.<span style="font-style: italic;">run</span>(<span style="color: black;">EurekaclientApplication</span>.<span style="color: #0033b3;">class</span>, args);<br />   }<br /><br />}</pre><span style="color: black; font-family: &quot;hiragino kaku gothic pron&quot;; font-size: medium; white-space: normal;">- 이제 유레카 서버페이지에 접속해서 새로고침하면 실행중인 클라이언트 목록이 보인다. 클라이언트의 스타터스를 클릭하면 클라이언트의 액튜에이터 정보페이지가 열린다.</span></pre><pre><font face=""><span style="white-space: normal;">- java -jar -DPORT=8082 -DNAME=taeho&nbsp; eurekaclient-0.0.1-SNAPSHOT.jar<br /></span></font><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt; white-space: normal;"><br /></pre></pre></div><div style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><br /></div></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;">참고 떙큐</pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><a href="https://projects.spring.io/spring-cloud/spring-cloud.html#_peer_awareness">https://projects.spring.io/spring-cloud/spring-cloud.html#_peer_awareness</a></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><a href="https://lion-king.tistory.com/12?category=855644">https://lion-king.tistory.com/12?category=855644</a></pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><a href="https://coe.gitbook.io/guide/service-discovery/eureka">https://coe.gitbook.io/guide/service-discovery/eureka</a> </pre><pre style="color: #080808; font-family: &quot;jetbrains mono&quot;; font-size: 9.8pt;"><a href="https://develop-yyg.tistory.com/5">https://develop-yyg.tistory.com/5</a></pre></pre></div><div><a href="https://jinhyy.tistory.com/52">https://jinhyy.tistory.com/52</a>&nbsp;&lt;-- 위에게시물을 복불한곳 , 개념이 없는건지....</div>