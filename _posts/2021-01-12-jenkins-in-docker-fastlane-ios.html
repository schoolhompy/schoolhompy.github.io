---
layout: post
title: Jenkins in Docker, Fastlane 을 젠킨스 노드를 통해  IOS빌드하기
date: '2021-01-12T04:57:00.003-08:00'
author: schoolhompy
tags:
- docker
- jenkins
- ios build
- fastlane
modified_time: '2021-01-12T05:32:13.761-08:00'
blogger_id: tag:blogger.com,1999:blog-4954243635432022205.post-4647676635684181861
blogger_orig_url: https://yunhos.blogspot.com/2021/01/jenkins-in-docker-fastlane-ios.html
---

<p>&nbsp;앞서 간단히 Fastlane을 통해 ipa 파일을 클릭한번으로 생성하는 것을 해봤다.&nbsp;<br />https://yunhos.blogspot.com/2021/01/ios-fastlane-ipa.html</p><p>이걸 젠킨스로 하고 싶은데, ubuntu linux기반이라&nbsp; Xcode에서만 컴파일&amp;인증이 가능하다.</p><p>물론 젠킨스를 맥에 설치하고&nbsp;<br /><br />https://stackoverflow.com/questions/32347839/building-an-ios-app-with-jenkins</p><p><span face="Consolas, Menlo, Monaco, &quot;Lucida Console&quot;, &quot;Liberation Mono&quot;, &quot;DejaVu Sans Mono&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, monospace, sans-serif" style="background-color: #e4e6e8; color: #242729; font-size: 13px; white-space: pre-wrap;">xcrun xcodebuild -project ProjectName.xcodeproj \ -configuration Release \ -destination 'platform=iOS Simulator,name=iPhone 6s' \ -allowProvisioningUpdates \ CODE_SIGN_STYLE='Automatic' PROVISIONING_PROFILE_SPECIFIER=${PROVISIONING_PROFILE} CODE_SIGN_IDENTITY=${CODE_SIGNING_IDENTITY}</span></p><p>이딴 명령어를 빌드 shell 에 입력하면 된다. ( fastlane 도 되겠네.)<br /><br />참고 자료</p><p>趣味でつくるiOSアプリこそJenkinsでリリースを自動化 https://qiita.com/makoto_kw/items/b23350aed11ea87cd92b</p><p><br /></p><p>-------------------------------------------------------</p><p>그런데 ios 개발자들이 모두 젠킨스 설치해서 빌드하면 특정 개발자가 없는때는 어케 빌드하나?&nbsp;</p><p>그리고 웬만하면 도커에 설치된 젠킨스에서 실행하고 싶었다.</p><p>검색해본 결과</p><p>딱맞는 강좌를 올린사람이 있었다.</p><p>CI/CD With Jenkins, Docker and Fastlane</p><p>https://medium.com/multinetinventiv/ci-cd-with-jenkins-docker-and-fastlane-p1-primer-6bfc28267381</p><p>요는 도커에 젠킨스를 올리고, 거기서는 ios 앱빌드가 안되니까 젠킨스의 멀티작업용 하위노드로 로컬피씨를 등록하고, 거기서 Fastlane을 돌려서 ios 을 성공적으로 빌드한다.</p><p>이런 시나리오다. 도커,젠킨스,fastlane,ios 코드사인 등이 설정이 쉽다면 오죽좋겠냐만은 징그러운 ios 빌드관련이라 역시 어렵다.</p><p><br /></p><p>일단 저사람 강좌를 따라서&nbsp;</p><p>1. 현재 IOS을 fastlane 으로 빌드 되도록 구성한다.</p><p>2. Docker + Jenkins 를 설치한다.</p><p>3. 맥에서 System preference -&gt; Sharing 으로 가서 [Remote Loin] 을 체크하고&nbsp;</p><p>[<span color="rgba(0, 0, 0, 0.85)" style="font-family: &quot;Helvetica Neue&quot;; font-size: 11px;">To log in to this computer remotely, type “ssh yourName@xxx.xxx.xxx.xxx”.]</span></p><p>을 확인한다. 즉 내부내트워크에서는 yourname사용자 이름으로 이 컴에 접속하도록한다.&nbsp;</p><p>이걸 도커의 젠킨스에서 접속할때 사용할거다.</p><p>4. 젠킨스를 실행해서 Manage Jenkins - &gt; Manage Node And Clouds 로 가서 [New Node]를 선택해서 맥을 노드로서 추가해야한다.</p><p>일단 처음에는 Node Name 입력 과 Permanent Agent만 선택하고 생성한다.</p><p>5. 다시 노드목록을 보면 젠킨스자신(master)와 아까 만든 노드이름이 있는데 새로만든 노드를 클릭해서 정보를 넣자. 노드 화면 왼쪽의 Configure를 선택하자.&nbsp;</p><p># of excutors 는 1</p><p>&nbsp;Remote root directory 는 자신의맥에 적당한 폴더를 만들고 지정하자 /User/yourname/temp</p><p>Launch method 는 노드에 접속할 방법인데, 아까 ssh 로 도커컨테이너에서 내맥에 접속할수 있도록 share 해주었으니 그 정보를 넣자.</p><p>Launch agents via SSH 선택<br />만일 이게 없다면&nbsp;SSH Build Agent Plugin 을 설치해야한다</p><p>Host 는 맥아이피(192.168.0.100등)</p><p>Credentials 는 Add에서 Username with password 타입으로 하되,&nbsp;</p><p>&nbsp; &nbsp;Username 은 아까 share 에서 표시된 사용자이름</p><p>&nbsp; password 는 맥로그인시의 암호와 같음</p><p>으로 저장하고. 창이 닫히면 생성한 Credentials (이번에는 yourname/***)을 선택하자.</p><p>나머진 그냥두자.&nbsp;</p><p>Relaunch 클릭해서 접속해보자.</p><p>6.위에서 다 입력했다면 젠킨스가 노드에 접속시도를 할것이다. 잘되었다면 접속시도 맨 마지막 줄에&nbsp;<span style="background-color: white; color: #333333; font-size: var(--font-size-monospace); white-space: pre-wrap;">Evacuated stdout</span></p><p><span style="background-color: white; color: #333333; font-size: var(--font-size-monospace); white-space: pre-wrap;">Agent successfully connected and online</span>&nbsp;</p><p>&nbsp;가 나온다. 그리고 다시 nodes 목록으로 가면 해당 노드에 디스크정보등이 잘 표시된다.</p><p>만일 접속이 안된다면&nbsp;</p><p>젠킨스컨테이너에 쉘접속해서 ssh yourname@xxx.xxx.xxx.xxx 로 맥으로 원겹접속한다음 yes해서 known_hosts 에 맥을 추가한다. 잘안될떄는 /root/.ssh/known_hosts 를 /var/jenkins/.ssh/known_hosts 로 755 권한으로 바꾸어서 복사해본다. 또는 그냥 접속만 해봐도 노드가 맥에 잘접속되는경우가 있다.</p><p>7.master&nbsp; 노드를 선택해서. configure 에서 # of excutors 는 0 으로 하자.&nbsp;</p><p>&nbsp;젠킨스환경설정 설명은 여기에&nbsp;</p><p>https://www.lesstif.com/continuous-integration/%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95-31850999.html</p><p>8. 도커컨테이너를 실행중인 젠킨스에서 맥으로 원격접속해서 뭔가하도록 하는 설정은 끝났다.</p><p>9.젠킨스잡을 생성해야 한다. New Item -&gt; Multibranch Pipeline을 선택해서 생성하자.</p><p>10. 새로운 아이템을 생성하면, 설정화면으로 가는데,</p><p>Build Configuration -&gt; Script Path 를 Jenkinsfile 로 입력해서 git에서 체크아웃한 파일등중에 해당 파일이 있으면 젠킨스가 해당파일의 내용을 실행하도록 하자.</p><p>Github도 설정하자. Credentials 에 github 설정시에 password가 자신이 알고 있는 비번으로 접속이 안된다고 할때가 있는데, 이럴때는 github.com -&gt; developer setting -&gt; personal access token 에서 토큰을 생성하고 암호입력란에 넣으면 된다.</p><p>11 . Scan Multibranch Pipeline Triggers 에</p><p>Periodically if not other wise run 체크하고 15분 인터벌준다.</p><p>Orphaned Item Strategy에</p><p>Discard old items 를 체크하고 max #...를 50으로 한다.</p><p>12. 이제 잡은 준비되었다. 아까 설정시에 Jenkinsfile 이 있으면 그안의 내용을 실행한다고 했으니 해당 파일을 체크아웃할 git 에 만들어서 푸시해놓자.</p><p>Jenkinsfile 은 구루비 언어로 만든다.</p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">#!groovy</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">def lastCommitInfo = ""</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">def skippingText = ""</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">def commitContainsSkip = 0</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">def slackMessage = ""</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">def shouldBuild = false</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">def pollSpec = ""</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">if(env.BRANCH_NAME == "master") {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; </span>pollSpec = "*/5 * * * *"</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">} else if(env.BRANCH_NAME == "test") {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; </span>pollSpec = "* * * * 1-5"</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">}</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">pipeline {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; </span>agent any</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; </span>triggers {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>pollSCM ignorePostCommitHooks: true, scmpoll_spec: pollSpec</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; </span>}</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; </span>stages {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>stage('Init') {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>steps {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>script {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>lastCommitInfo = sh(script: "git log -1", returnStdout: true).trim()</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>commitContainsSkip = sh(script: "git log -1 | grep '.*\\[skip ci\\].*'", returnStatus: true)</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>if(commitContainsSkip == 0) {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>skippingText = "Skipping commit."</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>env.shouldBuild = false</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>currentBuild.result = "NOT_BUILT"</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>}</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>stage('Build application for beta') {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>steps {</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>sh "ls"</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>sh "/Users/yourname/temp/unlockme.sh"</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>sh "/usr/local/bin/fastlane make_debug_ipa"</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span>}</span></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; &nbsp; &nbsp; </span>}</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"><span class="Apple-converted-space">&nbsp; &nbsp; </span>}</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">}</span></p><p><br class="Apple-interchange-newline" />13. 이제 Build Now 를 해보면 git 에서 체크아웃 한다음 Node설정에서 지정한 로컬맥폴더로 복사를 하고 Jenkinsfile에 있는 내용을 실행한다.</p><p>여기서 문제가 좀 있던게,&nbsp; 앱을 생성할때 사용하는 Codesign은 ssh를 통해서는 할수없도록 되어있기 때문에, 젠킨스에서 codesign전에 로컬에서 사용자암호를 묻는 과정을 생략해야한다.</p><p>그게 바로&nbsp;&nbsp;</p><span class="Apple-converted-space" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-variant-ligatures: no-common-ligatures;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-variant-ligatures: no-common-ligatures;">sh "/Users/yourname/temp/unlockme.sh"</span><div>파일내용은&nbsp;</div><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">#/bin/bash</span></p><p class="p2" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px; min-height: 14px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;"></span><br /></p><p class="p1" style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-stretch: normal; font-variant-east-asian: normal; font-variant-numeric: normal; line-height: normal; margin: 0px;"><span class="s1" style="font-variant-ligatures: no-common-ligatures;">security default-keychain -s '/Users/yourname/Library/Keychains/login.keychain'</span></p><div><span style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-variant-ligatures: no-common-ligatures;">security -v unlock-keychain -p "maybe MAC yourPass" "/Users/</span><span style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-variant-ligatures: no-common-ligatures;">yourname</span><span style="background-color: rgba(0, 0, 0, 0.9); color: #2fff12; font-family: D2Coding; font-size: 12px; font-variant-ligatures: no-common-ligatures;">/Library/Keychains/login.keychain"</span>&nbsp;</div><br class="Apple-interchange-newline" />14. 자 이제 돌려보면 node설정에서 지정했던 폴더 하위에 myapp.ipa 파일이 똭(또는 fastlane에서 서버로 보냈거나..등등) 이 생긴다. 그걸로 테스트 팀에 주면된다.<div><br /></div><div>&nbsp;</div>