---
layout: post
title: Unity3d 에서 네이티브 IOS 코드  불러내서 사용하기-심플
date: '2021-01-19T09:17:00.002-08:00'
author: schoolhompy
tags:
- unity
- ios
- object-c
modified_time: '2021-01-19T09:17:44.068-08:00'
thumbnail: https://1.bp.blogspot.com/-GwsNLH5anzE/YAb6DbsuntI/AAAAAAABGSs/i2GEAOUshvw-cg6KWIMdecrQQabH9YcRwCLcBGAsYHQ/s72-c/Screen%2BShot%2B2021-01-20%2Bat%2B0.25.39.png
blogger_id: tag:blogger.com,1999:blog-4954243635432022205.post-3621509375827140898
blogger_orig_url: https://yunhos.blogspot.com/2021/01/unity3d-ios.html
---

<p>&nbsp;참고사이트:https://twnkls.com/en/blogs/howto-native-android-plugins-for-unity3d-2/</p><p>한번보면 알게되는 강좌 :https://www.youtube.com/watch?v=zP5mjHzJR-o (Creating an iOS Plugin for Unity3D)</p><p><br /></p><p>1.일단 유니티 프로젝트를 생성한다.</p><p>2.Assets 목록에&nbsp;<br />- Plugins<br />&nbsp; -- iOS<br />- Scripts&nbsp;<br />가 있는지 확인하고 없으면 생성한다.</p><p>3. IOS폴더에 "ItsYourPlugin"이라는 스크립트를 생성하자.<br />이 스크립트는 생성하면 cs이지만, IOS연동용으로 하기위해&nbsp; .mm 확장자로 바꿔야 한다.<br /></p><p>4.바꿨다면 아이콘이 퍼즐조각으로 바뀐다. ( 난 유툽강좌대로 MyPlugin으로 했다)</p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-GwsNLH5anzE/YAb6DbsuntI/AAAAAAABGSs/i2GEAOUshvw-cg6KWIMdecrQQabH9YcRwCLcBGAsYHQ/s750/Screen%2BShot%2B2021-01-20%2Bat%2B0.25.39.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="504" data-original-width="750" src="https://1.bp.blogspot.com/-GwsNLH5anzE/YAb6DbsuntI/AAAAAAABGSs/i2GEAOUshvw-cg6KWIMdecrQQabH9YcRwCLcBGAsYHQ/s320/Screen%2BShot%2B2021-01-20%2Bat%2B0.25.39.png" width="320" /></a></div><br class="Apple-interchange-newline" />5.이제 저걸 더블클릭하면 Xcode가 에디터에 저 파일의 내용이 뜬다. cs 용 내용이므로 이걸 다 지우고 아래처럼 object-c코드로 바꾼다.<div>이 파일에는 헤더(보통 .h파일)와 바디(보통 .m)파일의 내용을 구분없이 한 파일에 쓰도록 한다.</div><div>ItsYourPlugin는 기본적으로 다음과 같이 구성한다.<br /><br /></div><div><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;"><span style="color: #557799;">#import &lt;Foundation/Foundation.h&gt;</span><br /><br /><br /><span style="color: #888888;">// 머리,xcode에서 .h 라고 있던녀석들</span><br /><span style="color: #008800; font-weight: bold;">@interface</span> <span style="color: #bb0066; font-weight: bold;">MyPlugin</span>: <span style="color: #bb0066; font-weight: bold;">NSObject</span><br />{</pre><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;">}<br /><span style="color: #008800; font-weight: bold;">@end</span><br /><br /><span style="color: #888888;">// 몸통,xcode에서 .m 라고 있던녀석들</span><br /><span style="color: #008800; font-weight: bold;">@implementation</span> <span style="color: #bb0066; font-weight: bold;">MyPlugin</span><br /><br /><span style="color: #008800; font-weight: bold;">@end</span><br /><br /><span style="color: #888888;">// 꼬리,Unity에서 보여줄 녀석들</span><br /><span style="color: #008800; font-weight: bold;">extern</span> <span style="background-color: #fff0f0;">"C"</span><br />{<br /><br />}</pre><div class="separator" style="clear: both; text-align: center;"><br /></div><br class="Apple-interchange-newline" />6. object-c 클래스를 unity 에서 불러내서 연동하려면 (객체화) 라는 것을 유니티가 할텐데,&nbsp; 유니티가 object-c쪽의 함수를 호출(정확히는 extern c를 통해 호출) 할때 마다 객체를 생성하면 메모리가 미쳐나갈수 있으니 싱글톤으로 만들어지도록 object-c쪽에 코드를 넣어야한다.&nbsp;<br />(게임 루프는 1초에 30-60 번! 이나 호출하기때문이다!!)</div><div><br /><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;"><span style="color: #888888;">// 몸통,xcode에서 .m 라고 있던녀석들</span><br /><span style="color: #008800; font-weight: bold;">@implementation</span> <span style="color: #bb0066; font-weight: bold;">MyPlugin</span><br /><br /><span style="color: #008800; font-weight: bold;">+</span>(MyPlugin*) <span style="color: #0066bb; font-weight: bold;">sharedInstance       //현재객체(MyPlugin)을 돌려받는 싱글톤 함수 선언</span><br />{<pre style="line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;"><span style="color: #008800; font-weight: bold;"><br class="Apple-interchange-newline" />    static</span> MyPlugin *_sharedInstance; //스택틱 빈객체선언</pre>    <span style="color: #008800; font-weight: bold;">static</span> <span style="color: #333399; font-weight: bold;">dispatch_once_t</span> onceToken; //APP 라이프 사이클에 마추어 단 한번만 실행되로록 보장 이라네..     dispatch_once(&amp;onceToken, ^{          NSLog(<span style="background-color: #fff0f0;">@"Create Instance IOS"</span>);         _sharedInstance = [[MyPlugin alloc] init];     });  // obejct-c 의 싱글톤 패턴작성패턴이다. 토큰이 없으면 MyPlugin 객체생성 후 스택틱 변수에넣음          <span style="color: #008800; font-weight: bold;">return</span> _sharedInstance; //스택틱 변수를 돌려줌.잉? 그럼왜 _s } <span style="color: #008800; font-weight: bold;">@end</span></pre><p><br /></p><p>7.자, 이제 유툽강좌에 있던 내용대로 써보자</p><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;"><span style="color: #557799;">#import &lt;Foundation/Foundation.h&gt;</span><br /><br /><span style="color: #008800; font-weight: bold;">@interface</span> <span style="color: #bb0066; font-weight: bold;">MyPlugin</span>: <span style="color: #bb0066; font-weight: bold;">NSObject</span><br />{<br /><br />    NSDate *creationDate;<br />}<br /><span style="color: #008800; font-weight: bold;">@end</span><br /><br /><span style="color: #008800; font-weight: bold;">@implementation</span> <span style="color: #bb0066; font-weight: bold;">MyPlugin</span><br /><br /><span style="color: #008800; font-weight: bold;">+</span>(MyPlugin*) <span style="color: #0066bb; font-weight: bold;">sharedInstance</span><br />{<br />    <span style="color: #008800; font-weight: bold;">static</span> MyPlugin *_sharedInstance;<br />    <span style="color: #008800; font-weight: bold;">static</span> <span style="color: #333399; font-weight: bold;">dispatch_once_t</span> onceToken;<br />    dispatch_once(&amp;onceToken, ^{<br />        NSLog(<span style="background-color: #fff0f0;">@"Create Instance IOS"</span>);<br />        _sharedInstance = [[MyPlugin alloc] init];<br />    });<br />    <br />    <span style="color: #008800; font-weight: bold;">return</span> _sharedInstance;<br />}<br /><br /><br /><span style="color: #008800; font-weight: bold;">-</span>(<span style="color: #333399; font-weight: bold;">id</span>)<span style="color: #0066bb; font-weight: bold;">init</span><br />{<br />    self = [super init];<br />    <span style="color: #008800; font-weight: bold;">if</span> (self)<br />        [self initHelper];<br />    <span style="color: #008800; font-weight: bold;">return</span> self;<br />    <br />}<br /><br /><span style="color: #008800; font-weight: bold;">-</span>(<span style="color: #333399; font-weight: bold;">void</span>)<span style="color: #0066bb; font-weight: bold;">initHelper</span><br />{<br />    NSLog(<span style="background-color: #fff0f0;">@"InintHelper callsed"</span>);<br />    creationDate = [NSDate date];<br />}<br /><br /><span style="color: #008800; font-weight: bold;">-</span>(<span style="color: #333399; font-weight: bold;">double</span>)<span style="color: #0066bb; font-weight: bold;">getElapsedTime</span><br />{   </pre><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;">    // 클래스 초기화 때 실행하는 initHelper 에서 creationDate(시작시간이겠지)을 만들고, timeIntervalSinceDate로 실행시간을 구한다. <br />    <span style="color: #008800; font-weight: bold;">return</span> [[NSDate date] timeIntervalSinceDate:creationDate];<br />}<br /><span style="color: #008800; font-weight: bold;">@end</span><br /><br /><br /><span style="color: #008800; font-weight: bold;">extern</span> <span style="background-color: #fff0f0;">"C"</span><br />{<br /><span style="color: #333399; font-weight: bold;">double</span> IOSgetElapsedTime() { //유니티에서는 이 함수를 호출할것이다.싱글톤객체 얻은후 getElapseTime 반환값을 유니티쪽에 던져줌.<br />    <span style="color: #008800; font-weight: bold;">return</span> [[MyPlugin sharedInstance] getElapsedTime];<br />}<br />}</pre><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;"><br /></pre><p>8.일단 object-c쪽은 준비가 되었다. 이제 Unity의 스크립트 등에서 object-c에서 만들어둔 함수&nbsp;<span style="color: #333333;">IOSgetElapsedTime 를 불러내보자.<br />Assets의 Scripts폴더밑에 PluginTest라는 스크립트를 생성하고 아래처럼 넣자</span></p><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;"><span style="color: #008800; font-weight: bold;">using</span> <span style="color: #0e84b5; font-weight: bold;">System.Collections</span>;<br /><span style="color: #008800; font-weight: bold;">using</span> <span style="color: #0e84b5; font-weight: bold;">System.Collections.Generic</span>;<br /><span style="color: #008800; font-weight: bold;">using</span> <span style="color: #0e84b5; font-weight: bold;">System.Runtime.InteropServices</span>;<br /><span style="color: #008800; font-weight: bold;">using</span> <span style="color: #0e84b5; font-weight: bold;">UnityEngine</span>;<br /><br /><span style="color: #008800; font-weight: bold;">public</span> <span style="color: #008800; font-weight: bold;">class</span> <span style="color: #bb0066; font-weight: bold;">PluginTest</span> : MonoBehaviour<br />{<br /><span style="color: #557799;">#if UNITY_IOS</span><br /><span style="color: #0000cc;">	[DllImport("__Internal")]</span> </pre><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;">    //DllImport는 C#에서 다른 프로그램을 불러낼때 쓰인다<br />    <span style="color: #008800; font-weight: bold;">private</span> <span style="color: #008800; font-weight: bold;">static</span> <span style="color: #008800; font-weight: bold;">extern</span> <span style="color: #333399; font-weight: bold;">double</span> <span style="color: #0066bb; font-weight: bold;">IOSgetElapsedTime</span>(); //아까 object-c에서 만든함수랑 같은 이름을 지정한다.<br /><span style="color: #557799;">#endif</span><br />    <span style="color: #888888;">// Start is called before the first frame update</span><br />    <span style="color: #008800; font-weight: bold;">void</span> <span style="color: #0066bb; font-weight: bold;">Start</span>()<br />    {<br />        Debug.Log(<span style="background-color: #fff0f0;">"Elapsed"</span> + getElapsedTime());<br />    }<br /><br />    <span style="color: #333399; font-weight: bold;">int</span> frameCounter = <span style="color: #6600ee; font-weight: bold;">0</span>;<br />    <span style="color: #888888;">// Update is called once per frame</span><br />    <span style="color: #008800; font-weight: bold;">void</span> <span style="color: #0066bb; font-weight: bold;">Update</span>()<br />    {<br />        frameCounter++;<br />        <span style="color: #008800; font-weight: bold;">if</span> (frameCounter &gt;= <span style="color: #6600ee; font-weight: bold;">5</span>) {<br />        	Debug.Log(<span style="background-color: #fff0f0;">"Tick"</span> + getElapsedTime());<br />        	frameCounter = <span style="color: #6600ee; font-weight: bold;">0</span>;<br />        }<br />    }<br /><br />    <span style="color: #333399; font-weight: bold;">double</span> <span style="color: #0066bb; font-weight: bold;">getElapsedTime</span>() { //Start랑 Update에서 불리는 함수다. IOS일때만 불리도록 했다.</pre><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;">    	<span style="color: #008800; font-weight: bold;">if</span> (Application.platform == RuntimePlatform.IPhonePlayer) <br />    	   <span style="color: #008800; font-weight: bold;">return</span> <span style="color: #0066bb; font-weight: bold;">IOSgetElapsedTime</span>();<br />    	<span style="color: #008800; font-weight: bold;">return</span> <span style="color: #6600ee; font-weight: bold;">0</span>;<br />    }<br />}</pre><p>9.자 이 스크립트를 카메라에 붙이자. 카메라는 항상있으니까.. 그럼 씬이 시작될때 start-&gt;update-&gt;update-&gt;update..... 하면서 실행후 지난시간들이 Log에 찍힌다.</p><p>10.이제&nbsp; &nbsp;유니티 프로젝트를 빌드해 보자</p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-rDE9g4YUYkM/YAcMGqdUTlI/AAAAAAABGS4/AhUvRPXbkr4YqAq-_K0tOnKtKcM10DiVACLcBGAsYHQ/s2048/Screen%2BShot%2B2021-01-20%2Bat%2B1.42.32.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1127" data-original-width="2048" src="https://1.bp.blogspot.com/-rDE9g4YUYkM/YAcMGqdUTlI/AAAAAAABGS4/AhUvRPXbkr4YqAq-_K0tOnKtKcM10DiVACLcBGAsYHQ/s320/Screen%2BShot%2B2021-01-20%2Bat%2B1.42.32.png" width="320" /></a></div><br class="Apple-interchange-newline" />10.빌드하면 Unity를 Xcode에서 빌드할수 있도록 저장폴더를 물어보고, 폴더를 선택했다면, Xcode가 열리면서 현재작업중인 모든 유티니관련 자료,라이브러리가 포함된 프로젝트가 열린다.</div><div><br /></div><div>11.위에서 작성한(ItsYourPlugin.mm)의 내용이 바뀌거나, unity에서 관련스크립트가 변경되었다면 항상 command+b를 눌러서 과정10에서 생성된 프로젝트에 동일하게 반영되도록 해야한다.</div><div><br /></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-OHMCAGHTSRA/YAcRBG_1uuI/AAAAAAABGTI/HC63hijJld0ack-pAoXxtCKwhuUzKmXTwCLcBGAsYHQ/s2048/Screen%2BShot%2B2021-01-20%2Bat%2B2.03.43.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1181" data-original-width="2048" height="317" src="https://1.bp.blogspot.com/-OHMCAGHTSRA/YAcRBG_1uuI/AAAAAAABGTI/HC63hijJld0ack-pAoXxtCKwhuUzKmXTwCLcBGAsYHQ/w548-h317/Screen%2BShot%2B2021-01-20%2Bat%2B2.03.43.png" width="548" /></a></div><br /><div><br /></div><div>Github :&nbsp;https://github.com/sugoigroup/cuddly-spork.git</div><div>나중에 내가 보려요..</div><div><br /></div><div>&nbsp;&nbsp;</div><div><p><br /></p></div>