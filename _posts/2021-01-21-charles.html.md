---
layout: posts
title: Charles 프로그램으로 앱 테스트시에 데이터 전송확인
date: '2021-01-21T05:27:00.004-08:00'
author: schoolhompy
tags:
- Charles
modified_time: '2021-01-21T05:27:59.869-08:00'
thumbnail: https://1.bp.blogspot.com/-u3567AWMVJg/YAl71xIt3_I/AAAAAAABGWg/9wPOvwj8dVkZJwULJdPsGwQSKNJxFe0TwCLcBGAsYHQ/s72-c/Screen%2BShot%2B2021-01-21%2Bat%2B21.57.15.png
blogger_id: tag:blogger.com,1999:blog-4954243635432022205.post-116323829102575916
blogger_orig_url: https://yunhos.blogspot.com/2021/01/charles.html
---

<p>&nbsp;앱에서 데이터가 제대로 서버로 전송되고 있는지 확인하기가 여간 까다롭다.</p><p>Charles라는 (유료)을 쓰면 전송데이터를 까볼수 있다.</p><p>원리는 Charles가 설치된 컴퓨터를 프록시서버로 정해서, 네트워크에 프록시로 지정한 컴퓨터에 일단 데이터를 까볼수 있게 보내면 프록시가 해당 주소에 대신 https 로 보내주는 거다.</p><p>ssl 통신보기, end point주소 강제 변경, 반복요청(Dos공격같은), 전송속도조절,리퀘스트 수정(앱을 수정안하고 데이터형태만 바꿔서 보내보고 싶은때등) 의 여러가지 기능이 있다.&nbsp;</p><p>이래서 해외 프록시서버 함부로 지정하면 걍 털리는 거다.</p><p>여튼</p><p>기본 사용법은</p><p>프로그램설치후 </p><p>1.Proxy메뉴에 SSL Proxying Settings 에 Include 에 ssl로 보내는걸 허용할 특정주소 또는 모든 주소 *:* 를 지정하면 모든 SSL 패킷에 대해 Charles를 거치게 된다.</p><p>include 항목에 *:*를 추가하자</p><p>2.Proxy메뉴의 Proxy Setting에 가면 포트가 있다 8888 로 두자. 이포트는 나중에 단말(아이폰과 안드로이드에서 네트워크속성에서 프록시지정할때에 사용된다.</p><p>3.안드로이드 단말의 경우 네트워크에서 접속중인 Wifi 연결정보를 수정할때(즉 인터넷연결 암호입력하는 그 창에서), Advanced Options을 눌러서 proxy항목을 none-&gt;Manual로 한다.</p><p>그밑의 Proxy hostname을 192.168.0.100으로 자신의 아이피를 지정</p><p>Proxy port를 아까의 8888 포트로 지정한다.</p><p>그러면 일단 연결이되고 인터넷전송데이터들이 Charles session의 목록에 보이지만 내용은 https 이라 볼수 없다.&nbsp;</p><p>4.우리 앱에서는 https로 보내더라도 Charles프로그램에서 그 내용을 까보도록 하고 싶다.</p><p>5.Charles 의 Help &gt; SSL proxing 에서 Install Charles Root Certicificate 를 해서 컴퓨터에 인증서를 설치하자.</p><p>6. 그리고 맥의keychain에서 charles키를 검색해서 그림처럼 Always Trust해준다. 컴터 로그인암호를 입력까지 해주면 파란색+ 버튼으로 바뀐다.</p><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-u3567AWMVJg/YAl71xIt3_I/AAAAAAABGWg/9wPOvwj8dVkZJwULJdPsGwQSKNJxFe0TwCLcBGAsYHQ/s2852/Screen%2BShot%2B2021-01-21%2Bat%2B21.57.15.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="1076" data-original-width="2852" src="https://1.bp.blogspot.com/-u3567AWMVJg/YAl71xIt3_I/AAAAAAABGWg/9wPOvwj8dVkZJwULJdPsGwQSKNJxFe0TwCLcBGAsYHQ/s320/Screen%2BShot%2B2021-01-21%2Bat%2B21.57.15.png" width="320" /><br /></a></div><br class="Apple-interchange-newline" />6.우리 안드로이드 앱에서는 앱안에 Charles의 인증서를 다운받아 넣어주면 전송데이터가 사람이 볼수 있는 형태가 된다<div>Charles &gt; help &gt; Save Charles Root Certificiate를 선택해서 인증서 파일을 cer 형식으로 지정하여 다운받는다.</div><div><br />7. 이제 우리앱에서&nbsp;</div><div>&nbsp;7-1.&nbsp;res/raw/charles_ssl_proxying_certificate.cer 에 아까 다운받은 파일을 넣는다.</div><div>&nbsp;7-2. res/xml/network_security_config.xml 파일을 만들고(있다면 그냥 내용만 비교해서 수정) 아래처럼 입력한다.</div><div><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;"><span style="color: #557799;">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br /><span style="color: #007700;">&lt;network-security-config&gt;</span><br />    <span style="color: #007700;">&lt;base-config&gt;</span><br />        <span style="color: #007700;">&lt;trust-anchors&gt;</span><br />            <span style="color: #007700;">&lt;certificates</span> <span style="color: #0000cc;">src=</span><span style="background-color: #fff0f0;">"system"</span><span style="color: #007700;">/&gt;</span><br />        <span style="color: #007700;">&lt;/trust-anchors&gt;</span><br />    <span style="color: #007700;">&lt;/base-config&gt;</span><br />    <span style="color: #007700;">&lt;debug-overrides&gt;</span><br />        <span style="color: #007700;">&lt;trust-anchors&gt;</span><br />            <span style="color: #007700;">&lt;certificates</span> <span style="color: #0000cc;">src=</span><span style="background-color: #fff0f0;">"@raw/charles_ssl_proxying_certificate"</span><span style="color: #007700;">/&gt;</span><br />        <span style="color: #007700;">&lt;/trust-anchors&gt;</span><br />    <span style="color: #007700;">&lt;/debug-overrides&gt;</span><br /><span style="color: #007700;">&lt;/network-security-config&gt;</span></pre><pre style="color: #333333; line-height: 16.25px; margin-bottom: 0px; margin-top: 0px;"><span style="color: #007700;"><br /></span></pre><p>8.앱을 실행하면 우리앱에서의 전송데이터(ssl 데이터도)가 그냥 모두 보이게&nbsp; 된다.</p><p>9. 에뮬레이터의 경우 인터넷 network proxy설정에서 맥컴퓨터의 아이피가 아니라 , gateway 10.10.0.2 등과 같이 지정해야 된다. (주의!)</p><p>10. 가끔 Charles의 프록시 설정 때문에&nbsp; Gradle이 원격지에서 데이터를 못가져올때 있다. 이때는 잠시 Charles 의 Stop proxy를 하자.</p><p>11.실기기나 에뮬의 경우 모바일통신이 켜져있으면 그걸 우선으로 하는 경우가 있어서 그걸끄고 해야 프록시가 적용된다.</p><p>&nbsp;</p><p><br /></p><p><br /></p></div>
